// egnyte-widget v0.1.1 (2014-05-22) 
// license:MIT 
// ztenerowicz 
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(a,b){(function(a){!function(b){function c(a){return"function"==typeof a}function d(a){return"object"==typeof a}function e(b){"undefined"!=typeof setImmediate?setImmediate(b):"undefined"!=typeof a&&a.nextTick?a.nextTick(b):setTimeout(b,0)}var f;b[0][b[1]]=function g(){var a,b=[],h=[],i=function(c,d){return null==a&&null!=c&&(a=c,b=d,h.length&&e(function(){for(var a=0;a<h.length;a++)h[a]()})),a};return i.then=function(i,j){var k=g(),l=function(){function e(a){var b,g=0;try{if(a&&(d(a)||c(a))&&c(b=a.then)){if(a===k)throw new TypeError;b.call(a,function(){g++||e.apply(f,arguments)},function(a){g++||k(!1,[a])})}else k(!0,arguments)}catch(h){g++||k(!1,[h])}}try{var g=a?i:j;c(g)?e(g.apply(f,b||[])):k(a,b)}catch(h){k(!1,[h])}};return null!=a?e(l):h.push(l),k},i.always=function(a){return i.then(a,a)},i.error=function(a){return i.then(0,a)},i}}("undefined"==typeof b?[window,"pinkySwear"]:[b,"exports"])}).call(this,a("FWaASH"))},{FWaASH:1}],3:[function(a,b){function c(a,b){function c(){4===k.readyState&&e()}function e(){var a=null,c=k.statusCode=k.status,d=k.body=k.response||k.responseText||k.responseXML;if(1223===c&&(c=204),0===c||c>=400&&600>c){var e=k.responseText||g[String(k.status).charAt(0)];a=new Error(e),a.statusCode=k.status}if(q)try{d=k.body=JSON.parse(d)}catch(f){}b(a,k,d)}function j(a){b(a,k)}"string"==typeof a&&(a={uri:a}),a=a||{},b=f(b);var k=a.xhr||null;!k&&a.cors?k=new i:k||(k=new h);var l=k.url=a.uri||a.url,m=k.method=a.method||"GET",n=a.body||a.data,o=k.headers=a.headers||{},p=!!a.sync,q=!1;return"json"in a&&(q=!0,"GET"!==m&&"HEAD"!==m&&(o["Content-Type"]="application/json",n=JSON.stringify(a.json))),k.onreadystatechange=c,k.onload=e,k.onerror=j,k.onprogress=function(){},k.ontimeout=d,k.open(m,l,!p),a.cors&&(k.withCredentials=!0),p||(k.timeout="timeout"in a?a.timeout:5e3),k.setRequestHeader&&Object.keys(o).forEach(function(a){k.setRequestHeader(a,o[a])}),"responseType"in a&&(k.responseType=a.responseType),k.send(n),k}function d(){}var e=a("global/window"),f=a("once"),g={0:"Internal XMLHttpRequest Error",4:"4xx Client Error",5:"5xx Server Error"},h=e.XMLHttpRequest||d,i="withCredentials"in new h?e.XMLHttpRequest:e.XDomainRequest;b.exports=c},{"global/window":4,once:5}],4:[function(a,b){(function(a){b.exports="undefined"!=typeof window?window:"undefined"!=typeof a?a:{}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(a,b){function c(a){var b=!1;return function(){return b?void 0:(b=!0,a.apply(this,arguments))}}b.exports=c,c.proto=c(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return c(this)},configurable:!0})})},{}],6:[function(a){!function(){"use strict";function b(b,e){d=c.extend(d,e),d.egnyteDomainURL=c.normalizeURL(b);var f=a("./lib/api")(d);return{domain:d.egnyteDomainURL,filePicker:a("./lib/filepicker/byapi")(d,f),filePickerRemote:a("./lib/filepicker/bysession")(d),API:f}}var c=a("./lib/reusables/helpers"),d={};window.EgnyteWidget={init:b}}()},{"./lib/api":7,"./lib/filepicker/byapi":11,"./lib/filepicker/bysession":12,"./lib/reusables/helpers":18}],7:[function(a,b){var c=a("./api_elements/auth"),d=a("./api_elements/storage"),e=a("./api_elements/link");b.exports=function(a){var b=c(a),f=d(b,a),g=e(b,a);return{auth:b,storage:f,link:g}}},{"./api_elements/auth":8,"./api_elements/link":9,"./api_elements/storage":10}],8:[function(a,b){function c(a){if(m)a();else{var b=o.exec(window.location.hash);b?b.length>1&&(m=b[1],a()):window.location.href=n.egnyteDomainURL+"/puboauth/token?client_id="+n.key+"&mobile="+~~n.mobile+"&redirect_uri="+window.location.href}}function d(a){a.setRequestHeader("Authorization","Bearer "+m)}function e(){return{Authorization:"Bearer "+m}}function f(){return n.egnyteDomainURL+"/pubapi/v1"}function g(){return!!m}function h(){return m}function i(a){m=a}function j(){m=null}function k(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function l(a,b){if(g())return a.params&&(a.url+="?"+k(a.params)),a.headers=a.headers||{},a.headers.Authorization="Bearer "+h(),p(a,function(a,c,d){try{d=JSON.parse(d)}catch(e){}if(403==c.statusCode&&q.test(c.responseText))throw new Error("Developer Over Qps");b.call(this,a,c,d)});throw new Error("Not authenticated")}var m,n,o=/access_token=([^&]+)/,p=a("xhr"),q=/<h1>Developer Over Qps<\/h1>/gi;b.exports=function(a){return n=a,n.token&&i(n.token),{isAuthenticated:g,setToken:i,authenticate:c,authorizeXHR:d,getHeaders:e,getToken:h,dropToken:j,getEndpoint:f,sendRequest:l}}},{xhr:3}],9:[function(a,b){function c(a){var b={path:null,type:"file",accessibility:"domain"},c=i.defer();if(a=j.extend(b,a),a.path=j.encodeNameSafe(a.path),!a.path)throw new Error("Path attribute missing or incorrect");return g.sendRequest({method:"POST",url:g.getEndpoint()+k,json:a},function(a,b,d){200==b.statusCode?c.resolve(d):c.reject(b.statusCode)}),c.promise}function d(a){var b=i.defer();return g.sendRequest({method:"DELETE",url:g.getEndpoint()+k+"/"+a},function(a,c){200==c.statusCode?b.resolve():b.reject(c.statusCode)}),b.promise}function e(a){var b=i.defer();return g.sendRequest({method:"GET",url:g.getEndpoint()+k+"/"+a},function(a,c,d){200==c.statusCode?b.resolve(d):b.reject(c.statusCode)}),b.promise}function f(a){var b=i.defer();return a.path=a.path&&j.encodeNameSafe(a.path),g.sendRequest({method:"get",url:g.getEndpoint()+k,params:a},function(a,c,d){200==c.statusCode?b.resolve(d):b.reject(c.statusCode)}),b.promise}var g,h,i=a("../promises"),j=a("../reusables/helpers"),k="/links";b.exports=function(a,b){return h=b,g=a,{createLink:c,removeLink:d,listLink:e,listLinks:f}}},{"../promises":16,"../reusables/helpers":18}],10:[function(a,b){function c(a){var b=n.defer();return a=o.encodeNameSafe(a)||"",l.sendRequest({method:"GET",url:l.getEndpoint()+p+"/"+encodeURI(a)},function(a,c){b.resolve(200==c.statusCode?!0:!1)}),b.promise}function d(a){var b=n.defer();return a=o.encodeNameSafe(a)||"",l.sendRequest({method:"GET",url:l.getEndpoint()+p+"/"+encodeURI(a)},function(a,c,d){b.resolve(d)}),b.promise}function e(a){var b=n.defer();return a=o.encodeNameSafe(a)||"",l.sendRequest({method:"GET",url:l.getEndpoint()+q+"/"+encodeURI(a)},function(a,c){b.resolve(c)}),b.promise}function f(a){var b=n.defer();return a=o.encodeNameSafe(a)||"",l.sendRequest({method:"POST",url:l.getEndpoint()+p+"/"+encodeURI(a),json:{action:"add_folder"}},function(c,d){201==d.statusCode?b.resolve({path:a}):b.reject(d.statusCode)}),b.promise}function g(a,b){if(!b)throw new Error("Cannot move to empty path");var c=n.defer();return a=o.encodeNameSafe(a)||"",b=o.encodeNameSafe(b),l.sendRequest({method:"POST",url:l.getEndpoint()+p+"/"+encodeURI(a),json:{action:"move",destination:"/"+b}},function(d,e){200==e.statusCode?c.resolve({oldPath:a,path:b}):c.reject(e.statusCode)}),c.promise}function h(a,b){if(!window.FormData)throw new Error("Unsupported browser");var c=n.defer(),d=b,e=new window.FormData;return e.append("file",d),a=o.encodeNameSafe(a)||"",l.sendRequest({method:"POST",url:l.getEndpoint()+q+"/"+encodeURI(a),body:e},function(b,d){200===d.statusCode||201===d.statusCode?c.resolve({id:d.getResponseHeader("etag"),path:a}):c.reject(d.statusCode)}),c.promise}function i(a,b){a=o.encodeNameSafe(a)||"";var c={method:"DELETE",url:l.getEndpoint()+p+"/"+encodeURI(a)},d=n.defer();return b&&(c.params={entry_id:b}),l.sendRequest(c,function(a,b){200==b.statusCode?d.resolve():d.reject(b.statusCode)}),d.promise}function j(a,b){if(!b)throw new Error("Version ID (second argument) is missing");return i(a,b)}function k(a){return i(a)}var l,m,n=a("../promises"),o=a("../reusables/helpers"),p="/fs",q="/fs-content";b.exports=function(a,b){return m=b,l=a,{exists:c,get:d,download:e,createFolder:f,move:g,rename:g,remove:k,storeFile:h,removeFileVersion:j}}},{"../promises":16,"../reusables/helpers":18}],11:[function(a,b){!function(){function c(a,b){var c;return a=d.extend(g,a),c=function(a,c,g,h){var i,j,k,l={folder:!0,file:!0,multiple:!0};return h=d.extend(l,h),i=function(){j.destroy(),j=null,k=null},k=new f(b,{select:h}),j=new e({el:a,model:k,handlers:{selection:function(a){c(a),i()},close:function(){g(),i()}}}),k.fetch("/"),{close:i}}}var d=a("../reusables/helpers"),e=(a("../reusables/dom"),a("../filepicker_elements/view")),f=a("../filepicker_elements/model"),g={};b.exports=c}()},{"../filepicker_elements/model":13,"../filepicker_elements/view":14,"../reusables/dom":17,"../reusables/helpers":18}],12:[function(a,b){!function(){function c(a,b){a.handler=i.createMessageHandler(a.sourceOrigin,a.marker,b),h.addListener(window,"message",a.handler)}function d(a,b){h.removeListener(window,"message",a.handler),b.parentNode&&b.parentNode.removeChild(b)}function e(a,b){return function(c){var d;if(c.action)switch(b.hasOwnProperty(c.action)&&b[c.action]&&b[c.action].call&&(d=b[c.action](c.data)),c.action){case"selection":d!==!1&&a();break;case"cancel":a()}}}function f(a){var b,f=!1;return a=g.extend(j,a),b=function(b,g,j){var k,l={marker:a.channelMarker,sourceOrigin:a.egnyteDomainURL},m=function(){a.openAt&&i.sendMessage(k.contentWindow,l,"openAt",a.openAt)},n=function(){d(l,k)},o=function(b){a.openAt=b,f&&m()};return k=h.createFrame(a.egnyteDomainURL+"/"+a.filepickerViewAddress),c(l,e(n,{selection:g,cancel:j,ready:function(){f=!0,m()}})),b.appendChild(k),{close:n,openAt:o}}}var g=a("../reusables/helpers"),h=a("../reusables/dom"),i=a("../reusables/messages"),j={filepickerViewAddress:"folderExplorer.html",channelMarker:"'E"};b.exports=f}()},{"../reusables/dom":17,"../reusables/helpers":18,"../reusables/messages":19}],13:[function(a,b){function c(a){return g.test(a)?a.replace(g,"$1"):""}function d(a,b){this.data=a,this.ext=this.data.is_folder?"":c(a.name),this.isSelectable=b.opts.select.folder&&a.is_folder||b.opts.select.file&&!a.is_folder,this.parent=b}function e(a,b){this.opts=b,this.API=a}var f=a("../reusables/helpers"),g=/.*\.([a-z0-9]*)$/i;d.prototype.defaultAction=function(){this.data.is_folder?this.parent.fetch(this.data.path):this.toggleSelect()},d.prototype.toggleSelect=function(){this.parent.opts.select.multiple||this.parent.deselect(),this.isSelectable&&(this.selected=!this.selected),this.parent.onchanged()};e.prototype.onloading=f.noop,e.prototype.onchanged=f.noop,e.prototype.onerror=f.noop,e.prototype.set=function(a){var b=this;this.path=a.path,this.items=[],f.each(a.folders,function(a){b.items.push(new d(a,b))}),this.opts.select.file&&f.each(a.files,function(a){b.items.push(new d(a,b))}),this.onchanged()},e.prototype.fetch=function(a){var b=this;a&&(this.path=a),b.onloading(),b.API.storage.get(this.path).then(function(a){b.set(a)}).error(function(){this.onerror()})},e.prototype.goUp=function(){var a=this.path.replace(/\/[^\/]+\/?$/i,"")||"/";a!==this.path&&this.fetch(a)},e.prototype.getSelected=function(){var a=[];return f.each(this.items,function(b){b.selected&&a.push(b.data)}),a},e.prototype.deselect=function(){f.each(this.items,function(a){a.selected=!1})},b.exports=e},{"../reusables/helpers":18}],14:[function(a,b){"use strict";function c(a){var b=this;this.el=a.el,this.els={},this.handlers=e.extend({selection:e.noop,close:e.noop},a.handlers),this.selection=e.extend(this.selection,a.selection),this.model=a.model,this.model.onloading=function(){b.loading()},this.model.onchanged=function(){b.render()},this.model.onerror=function(){};var c=f([["span",{"class":"eg-filepicker-back eg-btn"},"<"]]);this.els.back=c.children[0];var g=f([["span",{"class":"eg-filepicker-close eg-btn"},"x"]]);this.els.close=g.children[0];var h=f([["span.eg-btn","ok"]]);this.els.ok=h.children[0];var i=this;d.addListener(this.els.back,"click",function(){i.model.goUp()}),d.addListener(this.els.close,"click",function(a){i.handlers.close.call(i,a)}),d.addListener(this.els.ok,"click",function(){i.handlers.selection.call(i,i.model.getSelected())})}var d=a("../reusables/dom"),e=a("../reusables/helpers"),f=a("../../vendor/zenjungle");a("./view.less");c.prototype.render=function(){var a=this;this.els.list=document.createElement("ul");var b=f([["div.eg-filepicker",this.els.close,["div.eg-filepicker-bar",this.els.back,["span.eg-filepicker-path",this.model.path]],this.els.list,["div.eg-filepicker-bar",this.els.ok]]]);this.el.innerHTML="",this.el.appendChild(b),e.each(this.model.items,function(b){a.renderItem(b)})},c.prototype.renderItem=function(a){var b=f([["span.eg-filepicker-name",a.data.name]]).children[0],c=f([["input[type=checkbox]"+(a.isSelectable?"":".eg-not")]]).children[0];c.checked=a.selected;var e=f([["li.eg-filepicker-item",c,["span.eg-filepicker-ico-"+(a.data.is_folder?"folder":"file"),{"data-ext":a.ext},["span",a.ext]],b]]),g=e.children[0];d.addListener(b,"click",function(b){return b.stopPropagation(),a.defaultAction(),!1}),d.addListener(g,"click",function(){a.toggleSelect()}),this.els.list.appendChild(e)},c.prototype.loading=function(){this.els.list&&(this.els.list.innerHTML="",this.els.list.appendChild(f([["div.eg-spinner",["div"],"loading"]])))},c.prototype.destroy=function(){this.el.innerHTML="",this.el=null,this.els=null,this.model=null,this.handlers=null},b.exports=c},{"../../vendor/zenjungle":20,"../reusables/dom":17,"../reusables/helpers":18,"./view.less":15}],15:[function(){!function(){var a=document.getElementsByTagName("head")[0];style=document.createElement("style"),style.type="text/css";var b='.eg-btn{display:inline-block;line-height:20px;padding:0 10px;text-align:center;background-color:#f5f5f5;border:1px solid #aaa;border-radius:2px;font-weight:700;cursor:pointer}.eg-filepicker{border:1px solid #ddd;font-family:sans-serif;position:relative}.eg-filepicker ul{padding:0;margin:0;height:400px;overflow-y:scroll}.eg-filepicker-bar{padding:5px;background:#ddd}.eg-filepicker-back{margin-right:10px}.eg-filepicker-close{position:absolute;right:5px;top:5px}.eg-filepicker-item{line-height:1.2em;list-style:none;padding-top:5px;cursor:pointer}.eg-filepicker-item:hover{background-color:#f1f5f8}.eg-filepicker-item *{vertical-align:middle;display:inline-block}.eg-filepicker-item input{margin:10px}.eg-filepicker-item input.eg-not{visibility:hidden}.eg-filepicker-name{margin-left:.3em}.eg-filepicker-ico-file{width:40px;height:40px;background:#dbdbdb;text-align:right}.eg-filepicker-ico-file>span{text-align:center;font-size:16px;line-height:20px;font-weight:300;margin:10px 0;height:20px;width:32px;background:rgba(0,0,0,.15);color:#fff}.eg-filepicker-ico-folder{background-color:#e1e1ba;border:#d4d8bd .1em solid;border-radius:.1em;border-top-left-radius:0;font-size:10px;margin-top:.75em;height:2.9em;overflow:visible;width:4em;position:relative}.eg-filepicker-ico-folder:before{display:block;position:absolute;top:-.5em;left:-.1em;border:#d1dabc .1em solid;border-radius:.2em;border-bottom:0;border-bottom-right-radius:0;border-bottom-left-radius:0;background-color:#dfe4b9;content:" ";width:60%;height:.5em}.eg-filepicker-ico-folder:after{display:block;position:absolute;top:.3em;height:2.4em;left:0;width:100%;border-top-left-radius:.3em;border-top-right-radius:.3em;background-color:#f3f7d3;content:" "}.eg-filepicker-ico-folder>span{display:none}@-webkit-keyframes egspin{to{transform:rotate(360deg)}}@keyframes egspin{to{transform:rotate(360deg)}}.eg-spinner{margin:40%;margin:calc(50% - 42px)}.eg-spinner>div{content:"";-webkit-animation:egspin 1s infinite linear;animation:egspin 1s infinite linear;width:30px;height:30px;border:solid 7px;border-radius:50%;border-color:transparent transparent #ddd}';style.styleSheet?style.styleSheet.cssText=b:style.appendChild(document.createTextNode(b)),a.appendChild(style)}()},{}],16:[function(a,b){var c=a("pinkyswear");b.exports={defer:function(){var a=c();return{promise:a,resolve:function(b){a(!0,[b])},reject:function(b){a(!1,[b])}}}}},{pinkyswear:2}],17:[function(a,b){b.exports={addListener:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,function(a){a=a||window.event,a.target||(a.target=a.srcElement),c.call(this,a)})},removeListener:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)},createFrame:function(a){var b=document.createElement("iframe");return b.setAttribute("scrolling","no"),b.style.width="100%",b.style.height="100%",b.style.minWidth="400px",b.style.minHeight="400px",b.style.border="1px solid #dbdbdb",b.src=a,b}}},{}],18:[function(a,b){b.exports={extend:function(a){var b,c;for(b=1;b<arguments.length;b++)if(arguments[b])for(c in arguments[b])arguments[b].hasOwnProperty(c)&&(a[c]=arguments[b][c]);return a},noop:function(){},each:function(a,b){if(a)if(a.length===+a.length)for(var c=0;c<a.length;c++)b.call(null,a[c],c,a);else for(var c in a)a.hasOwnProperty(c)&&b.call(null,a[c],c,a)},normalizeURL:function(a){return a.replace(/\/*$/,"")},encodeNameSafe:function(a){return a.split("/").map(function(a){return a.replace(/[^a-z0-9 ]*/gi,"")}).join("/").replace(/^\//,""),a}}},{}],19:[function(a,b){function c(a,b,c){return function(d){if(!a||e.normalizeURL(d.origin)===e.normalizeURL(a)){var f=d.data;if(f.substr(0,2)===b){try{f=JSON.parse(f.substring(2))}catch(g){}f&&c(f)}}}}function d(a,b,c,d){var e="*";if("string"!=typeof d||"string"!=typeof c)throw new TypeError("only string is acceptable as action and data");try{e=a.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}catch(f){}d=d.replace(/"/gm,'\\"').replace(/(\r\n|\n|\r)/gm,""),a.postMessage(b.marker+'{"action":"'+c+'","data":"'+d+'"}',e)}var e=a("../reusables/helpers");b.exports={sendMessage:d,createMessageHandler:c}},{"../reusables/helpers":18}],20:[function(a,b){b.exports=function(){var a=function(a){return"[object Object]"==Object.prototype.toString.call(a)},b=function(a){return"[object Array]"==Object.prototype.toString.call(a)},c=function(a,b){var c;for(c in a)a.hasOwnProperty(c)&&b(a[c],c)},d=function(){var a={};return c(arguments,function(b){c(b,function(b,c){a[c]=b})}),a},e=function(a){var b={"\\[([a-z\\-]+)=([^\\]]+)\\]":function(a){var b={};return b[a[1]]=a[2].replace(/^["']/,"").replace(/["']$/,""),b},"#([a-zA-Z][a-zA-Z0-9\\-_]*)":function(a){return{id:a[1]}},"\\.([a-zA-Z][a-zA-Z0-9\\-_]*)":function(a){return{"class":a[1]}}},e={};return c(b,function(b,c){var f;for(c=new RegExp(c);c.test(a);)f=c.exec(a),a=a.replace(f[0],""),e=d(e,b(f))}),[a,e]},f=function(g,h){return h=h||document.createDocumentFragment(),c(g,function(g){var i,j,k;b(g)?"string"==typeof g[0]?(i=e(g.shift()),j=a(g[0])?g.shift():{},k=document.createElement(i[0]),c(d(i[1],j),function(a,b){k.setAttribute(b,a)}),h.appendChild(k),f(g,k)):f(g,h):1==g.nodeType||11==g.nodeType?h.appendChild(g):("string"==typeof g||"number"==typeof g)&&h.appendChild(document.createTextNode(g))}),h};return f}()},{}]},{},[6]);